"undefined"!=typeof window&&(window.exdi={}),function(t,e){"use strict";function n(t){return"function"==typeof t||"object"==typeof t&&t instanceof Array&&t.length>0&&"function"==typeof t[t.length-1]}function r(t){e?window.setTimeout(function(){t()},1):process.nextTick(t)}function i(t,e){function n(){return t.apply(this,e)}return n.prototype=t.prototype,new n}function o(t){var e=[],n=0;if(t instanceof Array){for(n=0;n<t.length-1;n++){if("string"!=typeof t[n]&&("number"!=typeof t[n]||isNaN(t[n])||!isFinite(t[n])))throw new Error("Invalid array argument for getFunctionParametersNames(): "+String(t[n]));e.push(String(t[n]))}return e}var r,i,o,u=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,s=/\s*,\s*/,a=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;if("function"!=typeof t)throw new Error("To extract parameters names you must provide a function");if(r=t.toString().replace(a,""),i=r.match(u),o=i[1].split(s),o.length)for(n=0;n<o.length;n++)o[n]&&e.push(o[n]);return e}function u(t){if(this instanceof u==!1)return new u(t);var e,r,i=[],o=0,s=[],a=0;e=function(){var n=!1;return i[o]&&o<i.length?(o++,i[o-1].params.exdiDone=e,t.execute(i[o-1].fn,i[o-1].params,i[o-1].context||t,!0)):(r&&clearTimeout(r),n=!0),n},this.add=function(t,e,r){if(!n(t))throw new Error("You can add only functions or array to queue");return e instanceof Object==!1&&(e={}),r&&r instanceof Object||(r=void 0),i.push({fn:t,params:e,context:r}),this},this.on=function(t,e){if(t=String(t).toLowerCase(),"timeout"!==t)throw new Error("Unrecognized event "+String(t));if(n(e))throw new Error("Callback must be a function");if("timeout"!==t)throw new Error("Unrecognized event "+t+". Available events are: step, timeout and done.");return s.push(e),this},this.setTimeoutLimit=function(t){return a=Math.abs(parseInt(t,10)),this},this.clearQueue=function(){return i=[],this},this.execute=function(){return o=0,e(),a>0&&(r=setTimeout(function(){for(e=function(){return!1},o=0;o<s.length;o++)t.execute(s[o],{},t,!0)},a)),this},this.run=this.execute}function s(t){if(this instanceof s==!1)return new s(t);var e,r={},i={},o=0,u=0,a=[],c=[],f=[],h=0;this.add=function(s,f,h){if(!n(s))throw new Error("You can add only functions to queue");return f instanceof Object==!1&&(f={}),h&&h instanceof Object||(h=void 0),o++,function(n){f.exdiDone=function(){if(i[n]===!1){i[n]=!0;var r,o=!0;for(r in i)if(i.hasOwnProperty(r)&&i[r]===!1){o=!1;break}if(o)for(e&&clearTimeout(e),u=0;u<c.length;u++)t.execute(c[u],{},t,!0);else for(u=0;u<a.length;u++)t.execute(a[u],{},t,!0)}},r[n]={fn:s,params:f,context:h},i[n]=!1}("task"+String(o)),this},this.clearTasks=function(){return r={},o=0,this},this.on=function(t,e){if(t=String(t).toLowerCase(),"step"!==t&&"done"!==t&&"timeout"!==t)throw new Error("Unrecognized event "+String(t));if(!n(e))throw new Error("Callback must be a function");if("step"===t)a.push(e);else if("timeout"===t)f.push(e);else{if("done"!==t)throw new Error("Unrecognized event "+t+". Available events are: step, timeout and done.");c.push(e)}return this},this.setTimeoutLimit=function(t){return h=Math.abs(parseInt(t,10)),this},this.execute=function(){var n;for(n in r)r.hasOwnProperty(n)&&(i[n]=!1,t.execute(r[n].fn,r[n].params,r[n].context||t,!0));return h>0&&(e=setTimeout(function(){for(i={},r={},o=0,u=0;u<f.length;u++)t.execute(f[u],{},t,!0)},h)),this},this.run=this.execute}function a(t){return this instanceof a==!1?new a(t):(t||(t={}),this.set=function(e,r){if(e=String(e),0===e.length||"exdi"===e)throw new Error("Invalid name");if(/^[A-Z]/.test(e[0].toString())&&!n(r))throw new Error("All variables named using first capital letter are constructors and must have first capital letter.");return t[e]=r,this},this.get=function(e,r,i){if(e=String(e),0===e.length)throw new Error("Invalid name");return"exdi"===e?this:/^[A-Z]/.test(e[0].toString())&&n(t[e])?this.execute(t[e],r,i,!1):void 0===t[e]?r:t[e]},this.remove=function(e){return e=String(e),delete t[e],this},this["delete"]=this.remove,this.execute=function(e,i,u,s){i||(i={});var a,c=[],f=0,h=!!(e instanceof Array);if(h&&e.length>0&&"string"==typeof e[e.length-1]&&(e[e.length-1]=this.get(e[e.length-1],{},this)),"string"==typeof e&&(e=this.get(e,{},this)),!n(e))throw new Error("You can only execute a function");if(a=o(e),a.length>0)for(f=0;f<a.length;f++)c.push(i[a[f]]?i[a[f]]:t[a[f]]?this.get(a[f],{},this):void 0);return u=u instanceof Object?u:this,h&&(e=e[e.length-1]),s===!0?r(function(){e.apply(u,c)}):e.apply(u,c)},this.construct=function(e,u,s){u||(u={});var a,c=[],f=0,h=!!(e instanceof Array);if(h&&e.length>0&&"string"==typeof e[e.length-1]&&(e[e.length-1]=this.get(e[e.length-1],{},this)),"string"==typeof e&&(e=this.get(e,{},this)),!n(e))throw new Error("You can only execute a function");if(a=o(e),a.length>0)for(f=0;f<a.length;f++)c.push(u[a[f]]?u[a[f]]:t[a[f]]?this.get(a[f],{},this):void 0);return h&&(e=e[e.length-1]),s===!0?r(function(){i(e,c)}):i(e,c)},this.run=this.execute,this.createQueue=function(){return new u(this)},void(this.createParallel=function(){return new s(this)}))}var c={};t.get=function(t){return t=String(t),c[t]instanceof a==!1&&(c[t]=new a({})),c[t]},t.all=function(){return c},t.remove=function(t){return t=String(t),delete c[t],this},t["delete"]=t.remove,t.create=function(){return new a},t.createContainer=t.create,t.createQueue=function(){return t.createContainer().createQueue()},t.createParallel=function(){return t.createContainer().createParallel()}}("undefined"==typeof window?module.exports:window.exdi,"undefined"==typeof window?!1:!0);